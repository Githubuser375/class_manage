<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hrh.class_manage_system.server.mapper.EmployeeCourseScheduleMapper">

    <select id="selectScheduleIdsByEmployee" resultType="java.lang.Integer">
        SELECT schedule_id
        FROM employee_course_schedule
        WHERE employee_id = #{employeeId}
    </select>

    <insert id="insert">
        INSERT INTO employee_course_schedule(employee_id, schedule_id)
        VALUES (#{employeeId}, #{scheduleId})
    </insert>

    <select id="countByScheduleId" resultType="int">
        SELECT COUNT(*)
        FROM employee_course_schedule
        WHERE schedule_id = #{scheduleId}
    </select>

    <update id="assignEmployees" parameterType="map">
        <!-- 1. 先删除该schedule_id下的所有现有分配 -->
        DELETE FROM employee_course_schedule
        WHERE schedule_id = #{scheduleId};
        
        <!-- 2. 插入新的分配（如果新列表不为空） -->
        <if test="employeeIds != null and !employeeIds.isEmpty()">
            INSERT INTO employee_course_schedule (schedule_id, employee_id)
            VALUES
            <foreach collection="employeeIds" item="employeeId" separator=",">
                (#{scheduleId}, #{employeeId})
            </foreach>
        </if>
    </update>
</mapper>